// Generated by CoffeeScript 1.9.1
(function() {
  var FastBricks, VoiceService, _, accountSID, authToken, fastB, query, sql, twilio;

  sql = require('sql-bricks');

  _ = require('underscore');

  twilio = require('twilio');

  accountSID = 'AC8b3510dfe729785e2fa921c066ae4586';

  authToken = 'bdc7f50dbc9ce7997d032a0e6c16c9b0';

  twilio(accountSID, authToken);

  FastBricks = require('fast-bricks');

  fastB = new FastBricks();

  fastB.loadConfig('database-config.cson');

  query = fastB.query;

  VoiceService = (function() {
    VoiceService.prototype.callURL = 'http://www.gamedealalerts.com:3000/voice/incoming';

    VoiceService.prototype.callbackURL = 'http://www.gamedealalerts.com:3000/voice/status';

    function VoiceService() {}

    VoiceService.prototype.saveCall = function(call) {
      var dbCall;
      ({
        columns: ['id', 'time_started', 'time_ended', 'duration', 'from', 'to', 'caller_id']
      });
      dbCall = _.pick(call, columns);
      return query(sql.insert('call', dbCall, function(err, result) {}));
    };

    VoiceService.prototype.sendSMS = function(from, to, body, callback) {
      var twilioMsg;
      twilioMsg = {
        to: to,
        from: from,
        body: body
      };
      return twilio.messages.create(twilioMsg, callback);
    };

    VoiceService.prototype.makeCall = function(from, to, startURL, statusURL, callback) {
      var twilioCall;
      twilioCall = {
        to: to,
        from: from,
        url: startURL,
        statusCallback: statusURL
      };
      return twilio.calls.create(twilioCall, callback);
    };

    return VoiceService;

  })();

  module.exports = new VoiceService();

}).call(this);
